<html>
    <head>
        <meta charset="utf-8">
        <script src="https://d3js.org/d3.v5.js"></script>
        <script src="image_dictionary.js"></script>
        <title>CPSC 583 Project</title>
        <style>
            p {
                font-size: 10px;
                margin: 2px;
            }
            body{
                background: #19181a;
                color:#f4f4f4;
                
            }
            #top,#about{
                margin: auto;
                width: 70%;
                padding: 10px;
            }
            img{
                filter:invert(1);
            }

        </style>
    </head>
    <body>
        <div id="top">
            <h1 id="pageTitle">An interactive vizualization of micronutrient content in fast food items</h1>
            Based on the food dataset, this vizualization highlights four key macro nutrients found in fast food items 
            from different chains
            
        </div>
        <div>
            <br>
        </div>
        <div id="visualization"></div>

        <script>
         const margin = {top: 10, right: 10, bottom: 10, left: 10}
            const width = 1200;
            const height = 400;
            loaded_data = {}

            let bars = {"fat": 0, "carbs": 0, "protein": 0, "water": 0, "sodium": 0}

            // add the base svg
            let svg = d3.select("#visualization")
                        .append("svg")
                            .attr("width", width + margin.left + margin.right)
                            .attr("height", height + margin.top + margin.bottom)
                            .call(
                                d3.zoom().on("zoom", function () {
                                svg.attr("transform", d3.event.transform)
                            }))
                        .append("g")
                        
            svg.append("rect")
                .attr("class", "background")
                .attr("fill", "#19181a")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .on("click", function(){
                    d3.selectAll("rect").attr("opacity", 1);
                })

            d3.json("./data.json")
                .then(function(data) {
                    loaded_data = data;
                    for(var resaurant in loaded_data){
                        for (var item in loaded_data[resaurant]){
                            loaded_data[resaurant][item]['fill']=randomColor();
                        }
                    }
                    change_subset("McDonald's", MCDs_Multi);
                });
            
            function display(item, bars, multiplier){
                let macros = ["fat", "carbs", "protein", "sodium"]
                for(let i = 0; i < macros.length; i++){
                    svg.data([item])
                        .append("rect")
                            .attr("class", "data")
                            .attr("x", bars[macros[i]])
                            .attr("y", 100*i)
                            .attr("width", parseFloat(item[macros[i]])*multiplier[macros[i]])
                            .attr("height", 50)
                            .attr("fill", item["fill"])
                            .on("click", function(d){
                                console.log(d["name"]);
                                highlight(d["name"], true)
                            })
                    bars[macros[i]] += parseFloat(item[macros[i]])*multiplier[macros[i]] + 1.0
                }
            }

            function highlight_txt(id, recurse){
               d3.selectAll(".txt")
                    .style("background-color", function(d){
                        if(d["name"] == id){
                            return "grey";
                        } else {
                            return "white";
                        }
                    })
                
                if(recurse){
                    highlight(id, false)
                }
            }
            

            function highlight(id, recurse){
                d3.selectAll(".data")
                    .attr("opacity", function(dat){
                        if(dat["name"] == id){
                            return 1
                        } else {
                            return 0.1
                        }
                    })
                if(recurse){
                    highlight_txt(id, false)
                }
            }
            
            function change_subset(restaurant,multiplier){
                // TO-DO change styling for tabs / buttons to show which is selected

                let bars = {"fat": 0, "carbs": 0, "protein": 0, "water": 0, "sodium": 0}
                d3.selectAll(".data").remove();
                for(let item of loaded_data[restaurant]){
                    display(item, bars, multiplier);
                }

                d3.selectAll(".img").remove()
                let imgs = d3.select("#text_section")

                var gridCols=23;
                imgs.append("div")
                imgs.append("tr")

                var currentCount=0;
                for(let item of loaded_data[restaurant]){
                    if (currentCount==gridCols){
                         currentCount=0;
                         imgs.append("tr");
                     }
                    currentCount=currentCount+1;
                    console.log(item["name"]);
                    console.log(dict[item["name"]]);
                    imgs
                        .append("td")
                        .data([item])
                            .attr("class", "img")
                            .on("click", function(){highlight_txt(item["name"], true)})
                            //.html(`<img src="./images/${restaurant}/${loaded_data[restaurant].indexOf(item)}.jpeg"style="width:50px;height:60px;">`)
                            .html(`<img src="./images/test/${dict[item["name"]]}"style="width:50px;height:60px;">`)
                }

            }
            const MCDs_Multi = {'fat':.5,'carbs':.5,'protein':.5,'water':.5, 'sodium':0.01};
            const BKs_Multi = {'fat':2,'carbs':2,'protein':2,'water':2, 'sodium':0.1};
            const WDs_Multi = {'fat':2,'carbs':2,'protein':2,'water':2, 'sodium':0.1};
            const PH_Multi  = {'fat':2,'carbs':2,'protein':2,'water':2, 'sodium':0.1};
            const DPs_Multi = {'fat':2,'carbs':2,'protein':2,'water':2, 'sodium':0.1};
            const KFC_Multi = {'fat':2,'carbs':2,'protein':2,'water':2, 'sodium':0.1};
            const TBs_Multi = {'fat':2,'carbs':2,'protein':2,'water':2, 'sodium':0.1};
            const Pop_Multi = {'fat':2,'carbs':2,'protein':2,'water':2, 'sodium':0.1};

           
            var randomColor = (function(){
            var golden_ratio_conjugate = 0.618033988749895;
            var h = Math.random();

            var hslToRgb = function (h, s, l){
                var r, g, b;

                if(s == 0){
                    r = g = b = l; // achromatic
                }else{
                    function hue2rgb(p, q, t){
                        if(t < 0) t += 1;
                        if(t > 1) t -= 1;
                        if(t < 1/6) return p + (q - p) * 6 * t;
                        if(t < 1/2) return q;
                        if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                        return p;
                    }

                    var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                    var p = 2 * l - q;
                    r = hue2rgb(p, q, h + 1/3);
                    g = hue2rgb(p, q, h);
                    b = hue2rgb(p, q, h - 1/3);
                }

                return '#'+Math.round(r * 255).toString(16)+Math.round(g * 255).toString(16)+Math.round(b * 255).toString(16);
            };
            
            return function(){
                h += golden_ratio_conjugate;
                h %= 1;
                return hslToRgb(h, 0.5, 0.60);
            };
            })();
            
        </script>
        
        <button onclick="change_subset('McDonald\'s', MCDs_Multi)" type="button">McDonald's</button>
        <button onclick="change_subset('Burger King', BKs_Multi)" type="button">Burger King</button>
        <button onclick="change_subset('Wendy\'s', WDs_Multi)" type="button">Wendy's</button>
        <button onclick="change_subset('Pizza Hut', PH_Multi)" type="button">Pizza Hut</button>
        <button onclick="change_subset('Dominos', DPs_Multi)" type="button">Dominos</button>
        <button onclick="change_subset('KFC', KFC_Multi)" type="button">KFC</button>
        <button onclick="change_subset('Taco Bell', TBs_Multi)" type="button">Taco Bell</button>
        <button onclick="change_subset('Popeyes', Pop_Multi)" type="button">Popeyes</button>
   
    <div id="text_section"></div>
    <div id="about">
        <h2>About</h2>
        <br>
        As univeristy students, fast food is a staple item in our diet, but we never truly 
        know all the macronutrients that we put into our body. We designed this vizualization 
        in order to help us see what we truly put into our body. 
        
        <h4>Insight</h4>
        

       
    </div>
</body>
</html>